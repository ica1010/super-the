{% extends "base/base.html" %}

{% load custom_tags %}
{% load static %}
{% block base %}
{% include 'include/navbar.html' %}
{% include 'include/sidebar.html' %}
<div class="page-wrapper">
    <div class="content">
       
        <div class="page-header">
            <div class="add-item d-flex">
                <div class="page-title">
                    <h4>Listes des commandes</h4>
                    <h6>la liste de toutes les commandes enregistrées</h6>
                </div>
            </div>
            <ul class="table-top-head">
                <li>
                    <a data-bs-toggle="tooltip" data-bs-placement="top" title="Pdf"><img
                            src="{% static 'assets/img/icons/pdf.svg' %}" alt="img"></a>
                </li>
                <li>
                    <a data-bs-toggle="tooltip" data-bs-placement="top" title="Excel"><img
                            src="{% static 'assets/img/icons/excel.svg' %}" alt="img"></a>
                </li>
                <li>
                    <a data-bs-toggle="tooltip" data-bs-placement="top" title="Print"><i data-feather="printer"
                            class="feather-rotate-ccw"></i></a>
                </li>
                <li>
                    <a data-bs-toggle="tooltip" data-bs-placement="top" title="Refresh"><i
                            data-feather="rotate-ccw" class="feather-rotate-ccw"></i></a>
                </li>
                <li>
                    <a data-bs-toggle="tooltip" data-bs-placement="top" title="Collapse" id="collapse-header"><i
                            data-feather="chevron-up" class="feather-chevron-up"></i></a>
                </li>
            </ul>
            <div class="page-btn">
                <a href="{% url 'deleted-orders-list' %}" class="btn btn-added"><i data-feather="trash"
                        class="me-2"></i>Corbelle</a>
            </div>
            <div class="page-btn">
                <a href="add-product.html" class="btn btn-added"><i data-feather="plus-circle"
                        class="me-2"></i>Lancer une nouvelle commande</a>
            </div>
        </div>
        <div class="card table-list-card">
            <div class="card-body">
                <div class="table-top">
                    <div class="search-set">
                        <div class="search-input">
                            <a href="javascript:void(0);" class="btn btn-searchset"><i data-feather="search"
                                    class="feather-search"></i></a>
                        </div>
                    </div>
                    <div class="search-path row">
                        <input type="date" name="" id="date_debut" style="width: 170px;" class="form-control col-4" >
                        <input type="date" name=""  id="date_fin" class="form-control col-4" style="width: 170px;" >
                        <a class="btn btn-filter" id="filter-btn">
                            <i data-feather="filter" class="filter-icon"></i>
                            <span><img src="{% static 'assets/img/icons/closes.svg' %}" alt="img"></span>
                        </a>
                    </div>
                </div>

                <div class="card mb-0" id="filter_inputs">
                    <div class="card-body pb-0">
                        <div class="row">
                            <div class="col-lg-12 col-sm-12">
                                <div class="row">
                                   
                                    <div class="col-lg-2 col-sm-6 col-12">
                                        <div class="input-blocks">
                                            <a class="btn btn-filters ms-auto"> <i data-feather="search"
                                                    class="feather-search"></i> Search </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-responsive product-list">
                    <table class="table datanew" id="order-table">
                        <thead>
                            <tr>
                                <th class="no-sort">ID de la commande</th>
                                <th class="no-sort" >Total</th>
                                <th class="no-sort text-center" >Date</th>
                                <th class="no-sort " >Fait par</th>
                                <th class="no-sort  text-center" >Recu</th>
                                <th class="no-sort"></th>
                            </tr>
                        </thead>
                        <tbody id="orders-list">
                            <p id="error-message"></p>
                            {% include 'partials/admin-order-list.html' %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>



{% for order in orders %}
<div class="modal fade" id="edit-sales-{{order.id}}">
   {% include 'partials/admin-order-update.html' %}
</div>
<div class="modal fade modal-default print-receipt-{{order.id}}" id="print-receipt" aria-labelledby="print-receipt">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="d-flex justify-content-end">
                <button type="button" class="close p-0" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body pt-0 px-3">
                <div id="reciept-85 pt-3 pb-3">
                    <center class="row text-center">
                        <h1>Super Thé</h1>
                        <h2>Numéro d'attente : {{order.id}} </h2>
                    </center>
                    <div class="tax-invoice">
                        <h3 class="mt-3">Avons ici</h3>
                        <p class="mb-0 text-lg">Date : {{order.add_at|date:'d/m/Y'}} </p>
                        <p class=" text-lg">Caissier(ere) : {{order.server}} </p>
                    </div>

                    <table class="table-borderless w-100 table-fit  mt-3 mb-3">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Prix</th>
                                <th>Quantité</th>
                                <th class="text-end">Montant</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in order.items.all %}
                            <tr>
                                <td>{{item.custom_product_name}}</td>
                                <td>{{item.size.price.amount}}</td>
                                <td style="text-align: center;"><center>{{item.quantity}}</center></td>
                                <td class="text-end"> {{ item.get_total}}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                    <div class="">
                        <table class="table table-responsive table-borderless">
                            <tr>
                                <td>Total</td>
                                <td class="text-end">{{order.get_total}}</td>
                            </tr>
                            <tr>
                                <td>Montant Remise</td>
                                <td class="text-end">{{order.montant_remise}}</td>
                            </tr>
                            <tr>
                                <td>Relicat</td>
                                <td class="text-end">{{order.relicat}}</td>
                            </tr>
                        </table>
                    </div>

                    


                    <div class="row" style="text-align: end;">
                        <h1>
                            Merci beaucoup !
                        </h1>
                    </div>

                </div>

                <div class="d-flex justify-content-center mt-4">
                    <button onclick="printReceipt()" class="btn btn-success btn-icon flex-fill"
                        aria-label="Commande suivante">
                        <span class="me-1 d-flex align-items-center">
                            <i data-feather="credit-card" class="feather-16"></i>
                        </span>
                        Imprimer
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="d-none">
    {% for item in order.items.all %}
        {% for i in item.quantity|times %}
            <div class="" id="autocollant-{{ item.id }}" style="justify-content: center; border: 1px solid #ccc; padding: 10px; margin: 10px 0; border-radius: 5px; background-color: #f9f9f9;">
                <div class="row"> 
                  <center>  <h1 style="margin: 0;width: 100%;">{{ order.id }}</h1></center>
                </div>
                <div  style="display: flex; justify-content: center; gap: 10px;">
                    <center>
                        <p style="margin: 5px 0; text-align: center;font-size:medium">{{ item.size.product.code }}</p>
                    </center>
                    <center>
                        <p style="margin: 5px 0; text-align: center; font-size:medium">{{ item.size.size }}</p>
                    </center>
                </div>
                <br><br><br>
                <div class="row">
                  <center>
                    <p style="margin: 5px 0; text-align: center;font-size:medium">{{ forloop.counter }} - {{ order.items.count }}</p>
                  </center>
                </div>
            </div>
        {% endfor %}
    {% endfor %}
</div>
{% endfor %}
    


{% endblock base %}
